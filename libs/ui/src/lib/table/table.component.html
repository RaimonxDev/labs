<div class="container-table">
  <button mat-button [matMenuTriggerFor]="showColumns">Columnas</button>

  <mat-form-field appearance="outline">
    <input [formControl]="inputSearch"  matInput placeholder="Buscar"  >
  </mat-form-field>


  <cdk-table matSort (matSortChange)="sortData($event)" [dataSource]="dataSource" recycleRows >
    <!-- action columns -->

    <ng-container [sticky]="true" [cdkColumnDef]="'actions'">
      <cdk-header-cell *cdkHeaderCellDef> </cdk-header-cell>
      <cdk-cell class="flex justify-center items-center" *cdkCellDef="let row">
        <button
          *ngIf="
            (_selections.isSelected(row) && hideActionsOfUnselectedElement) ||
            !_selections.hasValue() ||
            isMultipleSelection ||
            hideActionsOfUnselectedElement === false
          "
          mat-icon-button
          [matMenuTriggerFor]="menu"
          [matMenuTriggerData]="{row}"
          aria-label="action"
        >
          <mat-icon>more_vert</mat-icon>
        </button>
      </cdk-cell>
    </ng-container>

    <!-- Columns -->
    <ng-container *ngFor="let item of columnConfig; let i = index">
      <ng-container
        [sticky]="item?.sticky"
        [cdkColumnDef]="item.columnDef || ''"
      >
        <!-- obtener el header de la columna desde configTableExample -->
        <cdk-header-cell
          [mat-sort-header]="item.columnDef"
          [ngStyle]="{
            'min-width': item.width
          }"
          *cdkHeaderCellDef
        >
          <span class="column-content">
            {{ item.header }}
          </span>
        </cdk-header-cell>

        <!-- obtener el tipo de dato de la columna desde configTableExample -->
        <ng-container *ngIf="item.type === 'date'">
          <cdk-cell
            [ngStyle]="{
              'min-width': item.width
            }"
            (click)="item.cell?.(element)"
            *cdkCellDef="let element"
          >
            <span class="column-content ">
              {{ element[item.columnDef] | date : item.formatDate }}
            </span>
          </cdk-cell>
        </ng-container>

        <ng-container *ngIf="item.type === 'number'">
          <cdk-cell
            [ngStyle]="{
              'min-width': item.width,
            }"
            class="text-gray-800 flex items-center"
            *cdkCellDef="let element"
          >
            <span class="column-content">
              {{ element[item.columnDef] | currency : 'CLP' : '' }}
            </span>
          </cdk-cell>
        </ng-container>

        <ng-container *ngIf="item.type === 'currency'">
          <cdk-cell
            [ngStyle]="{
              'min-width': item.width,
            }"
            class="text-gray-800 flex items-center"
            *cdkCellDef="let element"
          >
            <span class="column-content">
              {{ element[item.columnDef] | currency : 'CLP' : '' }}
            </span>
          </cdk-cell>
        </ng-container>

        <ng-container *ngIf="item.type === 'text'">
          <cdk-cell
            [ngStyle]="{
              'min-width': item.width,
            }"
            class="flex items-center justify-end"
            *cdkCellDef="let element"
          >
            <span class="column-content">
              {{ element[item.columnDef] }}
            </span>
          </cdk-cell>
        </ng-container>
      </ng-container>
    </ng-container>

    <!-- checkbox column -->
    <ng-container [cdkColumnDef]="'checkbox'">
      <cdk-header-cell *cdkHeaderCellDef></cdk-header-cell>
      <cdk-cell *cdkCellDef="let row">
        <mat-checkbox
          [disabled]="
            !isMultipleSelection &&
            _selections.hasValue() &&
            !_selections.isSelected(row)
          "
          [checked]="_selections.isSelected(row)"
          (change)="selectRow(row)"
        ></mat-checkbox>
      </cdk-cell>
    </ng-container>

    <cdk-header-row
      *cdkHeaderRowDef="allColumns;"
    ></cdk-header-row>
    <cdk-row *cdkRowDef="let row; columns: allColumns"></cdk-row>
  </cdk-table>
</div>

<mat-menu #showColumns="matMenu">
  <ng-template matMenuContent let-row="row">
    <div class="flex flex-col">
      <mat-checkbox *ngFor="let item of columnsToDisplay"
      [checked]="_selectionsColumnsDisplayed.isSelected(item.columnDef)"
      (change)="handleShowColumnClick(item.columnDef)"
      (click)="$event.stopPropagation()"
      >
      {{ item.header }}
    </mat-checkbox>
    </div>
  </ng-template>
</mat-menu>

<mat-menu #menu="matMenu">
  <ng-template matMenuContent let-row="row">
    <button
      *ngFor="let item of actionsExample"
      (click)="handleActionClick(item, row)"
      mat-menu-item
    >
      {{ item | titlecase }}
    </button>
  </ng-template>
</mat-menu>
