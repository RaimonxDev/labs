<button mat-button [matMenuTriggerFor]="showColumns">Columnas</button>

<mat-form-field appearance="outline">
  <input [formControl]="inputSearch"  matInput placeholder="Buscar"  >
</mat-form-field>

<div class="container-table">
  <table cdk-table matSort [dataSource]="_dataSource" [trackBy]="trackByfn" >
    <!-- action columns -->

    <ng-container [sticky]="true" [cdkColumnDef]="'actions'">
      <th cdk-header-cell *cdkHeaderCellDef></th>
      <td cdk-cell *cdkCellDef="let row">
        <button
          *ngIf="
            (_selections.isSelected(row) && hideActionsOfUnselectedElement) ||
            !_selections.hasValue() ||
            isMultipleSelection ||
            hideActionsOfUnselectedElement === false
          "
          mat-icon-button
          [matMenuTriggerFor]="menu"
          [matMenuTriggerData]="{row}"
          aria-label="action"
        >
          <mat-icon>more_vert</mat-icon>
        </button>
      </td>
    </ng-container>

    <!-- Columns -->
    <ng-container *ngFor="let config of columnConfig; let i = index">
      <ng-container
        [sticky]="config?.sticky"
        [cdkColumnDef]="config.columnDef || ''"
      >
        <!-- obtener el header de la columna desde configTableExample -->
        <th cdk-header-cell
          [mat-sort-header]="config.columnDef"
          [ngStyle]="{
            'min-width': config.width?.min + 'px',
            'max-width': config.width?.max + 'px' || 'none',
          }"

          *cdkHeaderCellDef
        >
          <span class="column-content">
            {{ config.header }}
          </span>
        </th>

        <!-- obtener el tipo de dato de la columna desde configTableExample -->
        <ng-container *ngIf="config.type === 'date'">
          <td cdk-cell
            [ngClass]="element?.classCell=== config.classCell ? element?.classCell : '' "
            [ngStyle]="{
            'min-width': config.width?.min + 'px',
            'max-width': config.width?.max + 'px' || 'none',
          }"
            (click)="config.cell?.(element)"
            *cdkCellDef="let element"
          >
            <span class="column-content ">
              {{ element[config.columnDef] | date : config.formatDate }}
            </span>
          </td>
        </ng-container>

        <ng-container *ngIf="config.type === 'number'">
          <td cdk-cell
            [ngClass]="element?.classCell=== config.classCell ? element?.classCell : '' "
           (click)="config.cell?.(element)"
            [ngStyle]="{
            'min-width': config.width?.min + 'px',
            'max-width': config.width?.max + 'px' || 'none',
          }"
            class=""
            *cdkCellDef="let element"
          >
            <span class="column-content">
              {{ element[config.columnDef] | currency : 'CLP' : '' }}
            </span>
          </td>
        </ng-container>

        <ng-container *ngIf="config.type === 'currency'">
          <td cdk-cell
             [ngClass]="element?.classCell=== config.classCell ? element?.classCell : '' "
           (click)="config.cell?.(element)"
            [ngStyle]="{
            'min-width': config.width?.min + 'px',
            'max-width': config.width?.max + 'px' || 'none',
          }"
            class=""
            *cdkCellDef="let element"
          >
            <span class="column-content">
              {{ element[config.columnDef] | currency : 'CLP' : '' }}
            </span>
          </td>
        </ng-container>

        <!-- tipo texto por defecto -->
        <ng-container *ngIf="config.type === 'text' || !config.type"  >
          <td cdk-cell
          [ngClass]="element?.classCell=== config.classCell ? element?.classCell : '' "
           (click)="config.cell?.(element)"
            [ngStyle]="{
            'min-width': config.width?.min + 'px',
            'max-width': config.width?.max + 'px' || 'none',
            }"
            *cdkCellDef="let element"
          >
            <span class="column-content">
              {{ element[config.columnDef] }}
            </span>
          </td>
        </ng-container>
      </ng-container>
    </ng-container>

    <!-- checkbox column -->
    <ng-container [cdkColumnDef]="'checkbox'">
      <th cdk-header-cell *cdkHeaderCellDef></th>
      <td cdk-cell *cdkCellDef="let row">
        <mat-checkbox
          [disabled]="
            !isMultipleSelection &&
            _selections.hasValue() &&
            !_selections.isSelected(row)
          "
          [checked]="_selections.isSelected(row)"
          (change)="selectRow(row)"
        ></mat-checkbox>
      </td>
    </ng-container>

    <tr class="table-header" cdk-header-row
      *cdkHeaderRowDef="allColumns;"
    ></tr>
    <tr cdk-row *cdkRowDef="let row; columns: allColumns"></tr>
  </table>

  <mat-paginator
    [pageSize]="20"
    [pageSizeOptions]="[5, 10, 20, 50, 100]"
    ></mat-paginator>
</div>

<mat-menu #showColumns="matMenu">
  <ng-template matMenuContent let-row="row">
    <div class="flex flex-col">
      <mat-checkbox *ngFor="let item of columnsToDisplay"
      [checked]="_selectionsColumnsDisplayed.isSelected(item.columnDef)"
      (change)="handleShowColumnClick(item.columnDef)"
      (click)="$event.stopPropagation()"
      >
      {{ item.header }}
    </mat-checkbox>
    </div>
  </ng-template>
</mat-menu>

<mat-menu #menu="matMenu">
  <ng-template matMenuContent let-row="row">
    <button
      *ngFor="let item of actions"
      (click)="handleActionClick(item, row)"
      mat-menu-item
    >
      {{ item | titlecase }}
    </button>
  </ng-template>
</mat-menu>
